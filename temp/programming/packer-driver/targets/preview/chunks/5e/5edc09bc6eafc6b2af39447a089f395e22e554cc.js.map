{"version":3,"sources":["file:///C:/Users/admin/NewProject_18/assets/Scripts/External/immer/plugins/mapset.ts"],"names":["enableMapSet","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__extends","__","constructor","prototype","DraftMap","_super","target","parent","type_","parent_","scope_","modified_","finalized_","copy_","undefined","assigned_","base_","draft_","isManual_","revoked_","defineProperty","get","size","has","key","set","value","state","assertUnrevoked","prepareMapCopy","immer_","delete","clear","Map","forEach","cb","thisArg","_value","_map","call","draft","keys","values","iterator","next","r","done","entries","proxyMap_","DraftSet","drafts_","add","prepareSetCopy","result","Set","proxySet_","JSON","stringify","DRAFT_STATE","getCurrentScope","latest","iteratorSymbol","isDraftable","createProxy","loadPlugin","markChanged","ProxyTypeMap","ProxyTypeSet","die"],"mappings":"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","sourcesContent":["// types only!\nimport {\n\tImmerState,\n\tAnyMap,\n\tAnySet,\n\tMapState,\n\tSetState,\n\tDRAFT_STATE,\n\tgetCurrentScope,\n\tlatest,\n\titeratorSymbol,\n\tisDraftable,\n\tcreateProxy,\n\tloadPlugin,\n\tmarkChanged,\n\tProxyTypeMap,\n\tProxyTypeSet,\n\tdie\n} from \"../internal\"\n\nexport function enableMapSet() {\n\t/* istanbul ignore next */\n\tvar extendStatics = function(d: any, b: any): any {\n\t\textendStatics =\n\t\t\tObject.setPrototypeOf ||\n\t\t\t({__proto__: []} instanceof Array &&\n\t\t\t\tfunction(d, b) {\n\t\t\t\t\td.__proto__ = b\n\t\t\t\t}) ||\n\t\t\tfunction(d, b) {\n\t\t\t\tfor (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]\n\t\t\t}\n\t\treturn extendStatics(d, b)\n\t}\n\n\t// Ugly hack to resolve #502 and inherit built in Map / Set\n\tfunction __extends(d: any, b: any): any {\n\t\textendStatics(d, b)\n\t\tfunction __(this: any): any {\n\t\t\tthis.constructor = d\n\t\t}\n\t\td.prototype =\n\t\t\t// @ts-ignore\n\t\t\t((__.prototype = b.prototype), new __())\n\t}\n\n\tconst DraftMap = (function(_super) {\n\t\t__extends(DraftMap, _super)\n\t\t// Create class manually, cause #502\n\t\tfunction DraftMap(this: any, target: AnyMap, parent?: ImmerState): any {\n\t\t\tthis[DRAFT_STATE] = {\n\t\t\t\ttype_: ProxyTypeMap,\n\t\t\t\tparent_: parent,\n\t\t\t\tscope_: parent ? parent.scope_ : getCurrentScope()!,\n\t\t\t\tmodified_: false,\n\t\t\t\tfinalized_: false,\n\t\t\t\tcopy_: undefined,\n\t\t\t\tassigned_: undefined,\n\t\t\t\tbase_: target,\n\t\t\t\tdraft_: this as any,\n\t\t\t\tisManual_: false,\n\t\t\t\trevoked_: false\n\t\t\t} as MapState\n\t\t\treturn this\n\t\t}\n\t\tconst p = DraftMap.prototype\n\n\t\tObject.defineProperty(p, \"size\", {\n\t\t\tget: function() {\n\t\t\t\treturn latest(this[DRAFT_STATE]).size\n\t\t\t}\n\t\t\t// enumerable: false,\n\t\t\t// configurable: true\n\t\t})\n\n\t\tp.has = function(key: any): boolean {\n\t\t\treturn latest(this[DRAFT_STATE]).has(key)\n\t\t}\n\n\t\tp.set = function(key: any, value: any) {\n\t\t\tconst state: MapState = this[DRAFT_STATE]\n\t\t\tassertUnrevoked(state)\n\t\t\tif (latest(state).get(key) !== value) {\n\t\t\t\tprepareMapCopy(state)\n\t\t\t\tmarkChanged(state.scope_.immer_, state)\n\t\t\t\tstate.assigned_!.set(key, true)\n\t\t\t\tstate.copy_!.set(key, value)\n\t\t\t\tstate.assigned_!.set(key, true)\n\t\t\t}\n\t\t\treturn this\n\t\t}\n\n\t\tp.delete = function(key: any): boolean {\n\t\t\tif (!this.has(key)) {\n\t\t\t\treturn false\n\t\t\t}\n\n\t\t\tconst state: MapState = this[DRAFT_STATE]\n\t\t\tassertUnrevoked(state)\n\t\t\tprepareMapCopy(state)\n\t\t\tmarkChanged(state.scope_.immer_, state)\n\t\t\tstate.assigned_!.set(key, false)\n\t\t\tstate.copy_!.delete(key)\n\t\t\treturn true\n\t\t}\n\n\t\tp.clear = function() {\n\t\t\tconst state: MapState = this[DRAFT_STATE]\n\t\t\tassertUnrevoked(state)\n\t\t\tprepareMapCopy(state)\n\t\t\tmarkChanged(state.scope_.immer_, state)\n\t\t\tstate.assigned_ = new Map()\n\t\t\treturn state.copy_!.clear()\n\t\t}\n\n\t\tp.forEach = function(\n\t\t\tcb: (value: any, key: any, self: any) => void,\n\t\t\tthisArg?: any\n\t\t) {\n\t\t\tconst state: MapState = this[DRAFT_STATE]\n\t\t\tlatest(state).forEach((_value: any, key: any, _map: any) => {\n\t\t\t\tcb.call(thisArg, this.get(key), key, this)\n\t\t\t})\n\t\t}\n\n\t\tp.get = function(key: any): any {\n\t\t\tconst state: MapState = this[DRAFT_STATE]\n\t\t\tassertUnrevoked(state)\n\t\t\tconst value = latest(state).get(key)\n\t\t\tif (state.finalized_ || !isDraftable(value)) {\n\t\t\t\treturn value\n\t\t\t}\n\t\t\tif (value !== state.base_.get(key)) {\n\t\t\t\treturn value // either already drafted or reassigned\n\t\t\t}\n\t\t\t// despite what it looks, this creates a draft only once, see above condition\n\t\t\tconst draft = createProxy(state.scope_.immer_, value, state)\n\t\t\tprepareMapCopy(state)\n\t\t\tstate.copy_!.set(key, draft)\n\t\t\treturn draft\n\t\t}\n\n\t\tp.keys = function(): IterableIterator<any> {\n\t\t\treturn latest(this[DRAFT_STATE]).keys()\n\t\t}\n\n\t\tp.values = function(): IterableIterator<any> {\n\t\t\tconst iterator = this.keys()\n\t\t\treturn {\n\t\t\t\t[iteratorSymbol]: () => this.values(),\n\t\t\t\tnext: () => {\n\t\t\t\t\tconst r = iterator.next()\n\t\t\t\t\t/* istanbul ignore next */\n\t\t\t\t\tif (r.done) return r\n\t\t\t\t\tconst value = this.get(r.value)\n\t\t\t\t\treturn {\n\t\t\t\t\t\tdone: false,\n\t\t\t\t\t\tvalue\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} as any\n\t\t}\n\n\t\tp.entries = function(): IterableIterator<[any, any]> {\n\t\t\tconst iterator = this.keys()\n\t\t\treturn {\n\t\t\t\t[iteratorSymbol]: () => this.entries(),\n\t\t\t\tnext: () => {\n\t\t\t\t\tconst r = iterator.next()\n\t\t\t\t\t/* istanbul ignore next */\n\t\t\t\t\tif (r.done) return r\n\t\t\t\t\tconst value = this.get(r.value)\n\t\t\t\t\treturn {\n\t\t\t\t\t\tdone: false,\n\t\t\t\t\t\tvalue: [r.value, value]\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} as any\n\t\t}\n\n\t\tp[iteratorSymbol] = function() {\n\t\t\treturn this.entries()\n\t\t}\n\n\t\treturn DraftMap\n\t})(Map)\n\n\tfunction proxyMap_<T extends AnyMap>(target: T, parent?: ImmerState): T {\n\t\t// @ts-ignore\n\t\treturn new DraftMap(target, parent)\n\t}\n\n\tfunction prepareMapCopy(state: MapState) {\n\t\tif (!state.copy_) {\n\t\t\tstate.assigned_ = new Map()\n\t\t\tstate.copy_ = new Map(state.base_)\n\t\t}\n\t}\n\n\tconst DraftSet = (function(_super) {\n\t\t__extends(DraftSet, _super)\n\t\t// Create class manually, cause #502\n\t\tfunction DraftSet(this: any, target: AnySet, parent?: ImmerState) {\n\t\t\tthis[DRAFT_STATE] = {\n\t\t\t\ttype_: ProxyTypeSet,\n\t\t\t\tparent_: parent,\n\t\t\t\tscope_: parent ? parent.scope_ : getCurrentScope()!,\n\t\t\t\tmodified_: false,\n\t\t\t\tfinalized_: false,\n\t\t\t\tcopy_: undefined,\n\t\t\t\tbase_: target,\n\t\t\t\tdraft_: this,\n\t\t\t\tdrafts_: new Map(),\n\t\t\t\trevoked_: false,\n\t\t\t\tisManual_: false\n\t\t\t} as SetState\n\t\t\treturn this\n\t\t}\n\t\tconst p = DraftSet.prototype\n\n\t\tObject.defineProperty(p, \"size\", {\n\t\t\tget: function() {\n\t\t\t\treturn latest(this[DRAFT_STATE]).size\n\t\t\t}\n\t\t\t// enumerable: true,\n\t\t})\n\n\t\tp.has = function(value: any): boolean {\n\t\t\tconst state: SetState = this[DRAFT_STATE]\n\t\t\tassertUnrevoked(state)\n\t\t\t// bit of trickery here, to be able to recognize both the value, and the draft of its value\n\t\t\tif (!state.copy_) {\n\t\t\t\treturn state.base_.has(value)\n\t\t\t}\n\t\t\tif (state.copy_.has(value)) return true\n\t\t\tif (state.drafts_.has(value) && state.copy_.has(state.drafts_.get(value)))\n\t\t\t\treturn true\n\t\t\treturn false\n\t\t}\n\n\t\tp.add = function(value: any): any {\n\t\t\tconst state: SetState = this[DRAFT_STATE]\n\t\t\tassertUnrevoked(state)\n\t\t\tif (!this.has(value)) {\n\t\t\t\tprepareSetCopy(state)\n\t\t\t\tmarkChanged(state.scope_.immer_, state)\n\t\t\t\tstate.copy_!.add(value)\n\t\t\t}\n\t\t\treturn this\n\t\t}\n\n\t\tp.delete = function(value: any): any {\n\t\t\tif (!this.has(value)) {\n\t\t\t\treturn false\n\t\t\t}\n\n\t\t\tconst state: SetState = this[DRAFT_STATE]\n\t\t\tassertUnrevoked(state)\n\t\t\tprepareSetCopy(state)\n\t\t\tmarkChanged(state.scope_.immer_, state)\n\t\t\treturn (\n\t\t\t\tstate.copy_!.delete(value) ||\n\t\t\t\t(state.drafts_.has(value)\n\t\t\t\t\t? state.copy_!.delete(state.drafts_.get(value))\n\t\t\t\t\t: /* istanbul ignore next */ false)\n\t\t\t)\n\t\t}\n\n\t\tp.clear = function() {\n\t\t\tconst state: SetState = this[DRAFT_STATE]\n\t\t\tassertUnrevoked(state)\n\t\t\tprepareSetCopy(state)\n\t\t\tmarkChanged(state.scope_.immer_, state)\n\t\t\treturn state.copy_!.clear()\n\t\t}\n\n\t\tp.values = function(): IterableIterator<any> {\n\t\t\tconst state: SetState = this[DRAFT_STATE]\n\t\t\tassertUnrevoked(state)\n\t\t\tprepareSetCopy(state)\n\t\t\treturn state.copy_!.values()\n\t\t}\n\n\t\tp.entries = function entries(): IterableIterator<[any, any]> {\n\t\t\tconst state: SetState = this[DRAFT_STATE]\n\t\t\tassertUnrevoked(state)\n\t\t\tprepareSetCopy(state)\n\t\t\treturn state.copy_!.entries()\n\t\t}\n\n\t\tp.keys = function(): IterableIterator<any> {\n\t\t\treturn this.values()\n\t\t}\n\n\t\tp[iteratorSymbol] = function() {\n\t\t\treturn this.values()\n\t\t}\n\n\t\tp.forEach = function forEach(cb: any, thisArg?: any) {\n\t\t\tconst iterator = this.values()\n\t\t\tlet result = iterator.next()\n\t\t\twhile (!result.done) {\n\t\t\t\tcb.call(thisArg, result.value, result.value, this)\n\t\t\t\tresult = iterator.next()\n\t\t\t}\n\t\t}\n\n\t\treturn DraftSet\n\t})(Set)\n\n\tfunction proxySet_<T extends AnySet>(target: T, parent?: ImmerState): T {\n\t\t// @ts-ignore\n\t\treturn new DraftSet(target, parent)\n\t}\n\n\tfunction prepareSetCopy(state: SetState) {\n\t\tif (!state.copy_) {\n\t\t\t// create drafts for all entries to preserve insertion order\n\t\t\tstate.copy_ = new Set()\n\t\t\tstate.base_.forEach(value => {\n\t\t\t\tif (isDraftable(value)) {\n\t\t\t\t\tconst draft = createProxy(state.scope_.immer_, value, state)\n\t\t\t\t\tstate.drafts_.set(value, draft)\n\t\t\t\t\tstate.copy_!.add(draft)\n\t\t\t\t} else {\n\t\t\t\t\tstate.copy_!.add(value)\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\t}\n\n\tfunction assertUnrevoked(state: any /*ES5State | MapState | SetState*/) {\n\t\tif (state.revoked_) die(3, JSON.stringify(latest(state)))\n\t}\n\n\tloadPlugin(\"MapSet\", {proxyMap_, proxySet_})\n}\n"]}