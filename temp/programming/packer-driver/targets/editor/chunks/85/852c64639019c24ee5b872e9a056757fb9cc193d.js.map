{"version":3,"sources":["file:///C:/Users/admin/NewProject_18/assets/Scripts/External/immer/plugins/es5.ts"],"names":["enableES5","willFinalizeES5_","scope","result","isReplaced","drafts_","forEach","draft","finalizing_","patches_","markChangesRecursively","markChangesSweep","scope_","createES5Proxy_","base","parent","isArray","Array","clonePotentialDraft","prop","proxyProperty","isEnumerable","state","type_","ProxyTypeES5Object","modified_","finalized_","assigned_","parent_","base_","draft_","copy_","revoked_","isManual_","Object","defineProperty","value","writable","peek","get","assertUnrevoked","prepareCopy","immer_","set","markChangedES5_","descriptors","enumerable","desc","drafts","i","length","hasArrayChanges","hasObjectChanges","object","key","undefined","min","Math","keys","baseValue","descriptor","getOwnPropertyDescriptor","JSON","stringify","each","has","isDraft","isDraftable","shallowCopy","latest","DRAFT_STATE","is","loadPlugin","createProxy","ProxyTypeES5Array","getCurrentScope","die"],"mappings":"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","sourcesContent":["import {\n\tImmerState,\n\tDrafted,\n\tObjectish,\n\tES5ArrayState,\n\tES5ObjectState,\n\teach,\n\thas,\n\tisDraft,\n\tisDraftable,\n\tshallowCopy,\n\tlatest,\n\tDRAFT_STATE,\n\tis,\n\tloadPlugin,\n\tImmerScope,\n\tcreateProxy,\n\tProxyTypeES5Array,\n\tProxyTypeES5Object,\n\tAnyObject,\n\tgetCurrentScope,\n\tdie\n} from \"../internal\"\n\ntype ES5State = ES5ArrayState | ES5ObjectState\n\nexport function enableES5() {\n\tfunction willFinalizeES5_(\n\t\tscope: ImmerScope,\n\t\tresult: any,\n\t\tisReplaced: boolean\n\t) {\n\t\tscope.drafts_!.forEach((draft: any) => {\n\t\t\t;(draft[DRAFT_STATE] as ES5State).finalizing_ = true\n\t\t})\n\t\tif (!isReplaced) {\n\t\t\tif (scope.patches_) {\n\t\t\t\tmarkChangesRecursively(scope.drafts_![0])\n\t\t\t}\n\t\t\t// This is faster when we don't care about which attributes changed.\n\t\t\tmarkChangesSweep(scope.drafts_)\n\t\t}\n\t\t// When a child draft is returned, look for changes.\n\t\telse if (\n\t\t\tisDraft(result) &&\n\t\t\t(result[DRAFT_STATE] as ES5State).scope_ === scope\n\t\t) {\n\t\t\tmarkChangesSweep(scope.drafts_)\n\t\t}\n\t}\n\n\tfunction createES5Proxy_<T>(\n\t\tbase: T,\n\t\tparent?: ImmerState\n\t): Drafted<T, ES5ObjectState | ES5ArrayState> {\n\t\tconst isArray = Array.isArray(base)\n\t\tconst draft: any = clonePotentialDraft(base)\n\n\t\teach(draft, prop => {\n\t\t\tproxyProperty(draft, prop, isArray || isEnumerable(base, prop))\n\t\t})\n\n\t\tconst state: ES5ObjectState | ES5ArrayState = {\n\t\t\ttype_: isArray ? ProxyTypeES5Array : (ProxyTypeES5Object as any),\n\t\t\tscope_: parent ? parent.scope_ : getCurrentScope(),\n\t\t\tmodified_: false,\n\t\t\tfinalizing_: false,\n\t\t\tfinalized_: false,\n\t\t\tassigned_: {},\n\t\t\tparent_: parent,\n\t\t\tbase_: base,\n\t\t\tdraft_: draft,\n\t\t\tcopy_: null,\n\t\t\trevoked_: false,\n\t\t\tisManual_: false\n\t\t}\n\n\t\tObject.defineProperty(draft, DRAFT_STATE, {\n\t\t\tvalue: state,\n\t\t\t// enumerable: false <- the default\n\t\t\twritable: true\n\t\t})\n\t\treturn draft\n\t}\n\n\t// Access a property without creating an Immer draft.\n\tfunction peek(draft: Drafted, prop: PropertyKey) {\n\t\tconst state: ES5State = draft[DRAFT_STATE]\n\t\tif (state && !state.finalizing_) {\n\t\t\tstate.finalizing_ = true\n\t\t\tconst value = draft[prop]\n\t\t\tstate.finalizing_ = false\n\t\t\treturn value\n\t\t}\n\t\treturn draft[prop]\n\t}\n\n\tfunction get(state: ES5State, prop: string | number) {\n\t\tassertUnrevoked(state)\n\t\tconst value = peek(latest(state), prop)\n\t\tif (state.finalizing_) return value\n\t\t// Create a draft if the value is unmodified.\n\t\tif (value === peek(state.base_, prop) && isDraftable(value)) {\n\t\t\tprepareCopy(state)\n\t\t\t// @ts-ignore\n\t\t\treturn (state.copy_![prop] = createProxy(\n\t\t\t\tstate.scope_.immer_,\n\t\t\t\tvalue,\n\t\t\t\tstate\n\t\t\t))\n\t\t}\n\t\treturn value\n\t}\n\n\tfunction set(state: ES5State, prop: string | number, value: any) {\n\t\tassertUnrevoked(state)\n\t\tstate.assigned_[prop] = true\n\t\tif (!state.modified_) {\n\t\t\tif (is(value, peek(latest(state), prop))) return\n\t\t\tmarkChangedES5_(state)\n\t\t\tprepareCopy(state)\n\t\t}\n\t\t// @ts-ignore\n\t\tstate.copy_![prop] = value\n\t}\n\n\tfunction markChangedES5_(state: ImmerState) {\n\t\tif (!state.modified_) {\n\t\t\tstate.modified_ = true\n\t\t\tif (state.parent_) markChangedES5_(state.parent_)\n\t\t}\n\t}\n\n\tfunction prepareCopy(state: ES5State) {\n\t\tif (!state.copy_) state.copy_ = clonePotentialDraft(state.base_)\n\t}\n\n\tfunction clonePotentialDraft(base: Objectish) {\n\t\tconst state: ES5State | undefined = base && (base as any)[DRAFT_STATE]\n\t\tif (state) {\n\t\t\tstate.finalizing_ = true\n\t\t\tconst draft = shallowCopy(state.draft_, true)\n\t\t\tstate.finalizing_ = false\n\t\t\treturn draft\n\t\t}\n\t\treturn shallowCopy(base)\n\t}\n\n\t// property descriptors are recycled to make sure we don't create a get and set closure per property,\n\t// but share them all instead\n\tconst descriptors: {[prop: string]: PropertyDescriptor} = {}\n\n\tfunction proxyProperty(\n\t\tdraft: Drafted<any, ES5State>,\n\t\tprop: string | number,\n\t\tenumerable: boolean\n\t) {\n\t\tlet desc = descriptors[prop]\n\t\tif (desc) {\n\t\t\tdesc.enumerable = enumerable\n\t\t} else {\n\t\t\tdescriptors[prop] = desc = {\n\t\t\t\t// configurable: true,\n\t\t\t\tenumerable,\n\t\t\t\tget(this: any) {\n\t\t\t\t\treturn get(this[DRAFT_STATE], prop)\n\t\t\t\t},\n\t\t\t\tset(this: any, value) {\n\t\t\t\t\tset(this[DRAFT_STATE], prop, value)\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tObject.defineProperty(draft, prop, desc)\n\t}\n\n\t// This looks expensive, but only proxies are visited, and only objects without known changes are scanned.\n\tfunction markChangesSweep(drafts: Drafted<any, ImmerState>[]) {\n\t\t// The natural order of drafts in the `scope` array is based on when they\n\t\t// were accessed. By processing drafts in reverse natural order, we have a\n\t\t// better chance of processing leaf nodes first. When a leaf node is known to\n\t\t// have changed, we can avoid any traversal of its ancestor nodes.\n\t\tfor (let i = drafts.length - 1; i >= 0; i--) {\n\t\t\tconst state: ES5State = drafts[i][DRAFT_STATE]\n\t\t\tif (!state.modified_) {\n\t\t\t\tswitch (state.type_) {\n\t\t\t\t\tcase ProxyTypeES5Array:\n\t\t\t\t\t\tif (hasArrayChanges(state)) markChangedES5_(state)\n\t\t\t\t\t\tbreak\n\t\t\t\t\tcase ProxyTypeES5Object:\n\t\t\t\t\t\tif (hasObjectChanges(state)) markChangedES5_(state)\n\t\t\t\t\t\tbreak\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction markChangesRecursively(object: any) {\n\t\tif (!object || typeof object !== \"object\") return\n\t\tconst state: ES5State | undefined = object[DRAFT_STATE]\n\t\tif (!state) return\n\t\tconst {base_, draft_, assigned_, type_} = state\n\t\tif (type_ === ProxyTypeES5Object) {\n\t\t\t// Look for added keys.\n\t\t\t// TODO: looks quite duplicate to hasObjectChanges,\n\t\t\t// probably there is a faster way to detect changes, as sweep + recurse seems to do some\n\t\t\t// unnecessary work.\n\t\t\t// also: probably we can store the information we detect here, to speed up tree finalization!\n\t\t\teach(draft_, key => {\n\t\t\t\tif ((key as any) === DRAFT_STATE) return\n\t\t\t\t// The `undefined` check is a fast path for pre-existing keys.\n\t\t\t\tif ((base_ as any)[key] === undefined && !has(base_, key)) {\n\t\t\t\t\tassigned_[key] = true\n\t\t\t\t\tmarkChangedES5_(state)\n\t\t\t\t} else if (!assigned_[key]) {\n\t\t\t\t\t// Only untouched properties trigger recursion.\n\t\t\t\t\tmarkChangesRecursively(draft_[key])\n\t\t\t\t}\n\t\t\t})\n\t\t\t// Look for removed keys.\n\t\t\teach(base_, key => {\n\t\t\t\t// The `undefined` check is a fast path for pre-existing keys.\n\t\t\t\tif (draft_[key] === undefined && !has(draft_, key)) {\n\t\t\t\t\tassigned_[key] = false\n\t\t\t\t\tmarkChangedES5_(state)\n\t\t\t\t}\n\t\t\t})\n\t\t} else if (type_ === ProxyTypeES5Array) {\n\t\t\tif (hasArrayChanges(state as ES5ArrayState)) {\n\t\t\t\tmarkChangedES5_(state)\n\t\t\t\tassigned_.length = true\n\t\t\t}\n\n\t\t\tif (draft_.length < base_.length) {\n\t\t\t\tfor (let i = draft_.length; i < base_.length; i++) assigned_[i] = false\n\t\t\t} else {\n\t\t\t\tfor (let i = base_.length; i < draft_.length; i++) assigned_[i] = true\n\t\t\t}\n\n\t\t\t// Minimum count is enough, the other parts has been processed.\n\t\t\tconst min = Math.min(draft_.length, base_.length)\n\n\t\t\tfor (let i = 0; i < min; i++) {\n\t\t\t\t// Only untouched indices trigger recursion.\n\t\t\t\tif (assigned_[i] === undefined) markChangesRecursively(draft_[i])\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction hasObjectChanges(state: ES5ObjectState) {\n\t\tconst {base_, draft_} = state\n\n\t\t// Search for added keys and changed keys. Start at the back, because\n\t\t// non-numeric keys are ordered by time of definition on the object.\n\t\tconst keys = Object.keys(draft_)\n\t\tfor (let i = keys.length - 1; i >= 0; i--) {\n\t\t\tconst key = keys[i]\n\t\t\tconst baseValue = base_[key]\n\t\t\t// The `undefined` check is a fast path for pre-existing keys.\n\t\t\tif (baseValue === undefined && !has(base_, key)) {\n\t\t\t\treturn true\n\t\t\t}\n\t\t\t// Once a base key is deleted, future changes go undetected, because its\n\t\t\t// descriptor is erased. This branch detects any missed changes.\n\t\t\telse {\n\t\t\t\tconst value = draft_[key]\n\t\t\t\tconst state: ImmerState = value && value[DRAFT_STATE]\n\t\t\t\tif (state ? state.base_ !== baseValue : !is(value, baseValue)) {\n\t\t\t\t\treturn true\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// At this point, no keys were added or changed.\n\t\t// Compare key count to determine if keys were deleted.\n\t\treturn keys.length !== Object.keys(base_).length\n\t}\n\n\tfunction hasArrayChanges(state: ES5ArrayState) {\n\t\tconst {draft_} = state\n\t\tif (draft_.length !== state.base_.length) return true\n\t\t// See #116\n\t\t// If we first shorten the length, our array interceptors will be removed.\n\t\t// If after that new items are added, result in the same original length,\n\t\t// those last items will have no intercepting property.\n\t\t// So if there is no own descriptor on the last position, we know that items were removed and added\n\t\t// N.B.: splice, unshift, etc only shift values around, but not prop descriptors, so we only have to check\n\t\t// the last one\n\t\tconst descriptor = Object.getOwnPropertyDescriptor(\n\t\t\tdraft_,\n\t\t\tdraft_.length - 1\n\t\t)\n\t\t// descriptor can be null, but only for newly created sparse arrays, eg. new Array(10)\n\t\tif (descriptor && !descriptor.get) return true\n\t\t// For all other cases, we don't have to compare, as they would have been picked up by the index setters\n\t\treturn false\n\t}\n\n\t/*#__PURE__*/\n\tfunction isEnumerable(base: AnyObject, prop: PropertyKey): boolean {\n\t\tconst desc = Object.getOwnPropertyDescriptor(base, prop)\n\t\treturn desc && desc.enumerable ? true : false\n\t}\n\n\tfunction assertUnrevoked(state: any /*ES5State | MapState | SetState*/) {\n\t\tif (state.revoked_) die(3, JSON.stringify(latest(state)))\n\t}\n\n\tloadPlugin(\"ES5\", {\n\t\tcreateES5Proxy_,\n\t\tmarkChangedES5_,\n\t\twillFinalizeES5_\n\t})\n}\n"]}